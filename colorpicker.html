<!DOCTYPE html>
<html>
<head>
    <title>colorpicker</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html {
            user-select: none;
            overflow: auto;
            font-family: monospace;
            color: #323232;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: whitesmoke;
            display: table-cell;
            height: 100vh;
            width: 100vw;
            vertical-align: middle;
        }

        canvas {
            display: block;
            margin: 0 auto 1vmin auto;
            left: 0;
            right: 0;
        }

        #header {
            margin: 0 auto;
            left: 0;
            right: 0;
            width: 100vmin;
            height: auto
        }
            #header div {
                margin-left: 2vmin;
                margin-bottom: 1vmin;
                font-size: 2em;
            }

        #wrap {
            margin: 0 auto;
            left: 0;
            right: 0;
            width: 100vmin;
            height: auto
        }

            #wrap div {
                display: flex;
                flex-direction: row;
                align-items:center;
                margin-left: 2vmin;
                margin-bottom: 1vmin;
            }

                #wrap div input {
                    font-family: monospace;
                }
    </style>
</head>
<body>
    <div id="header">
        <div>colorpicker</div>
    </div>
    <canvas></canvas>
    <div id="wrap">
        <div>
            <label>hex:&nbsp;&nbsp;</label>
            <input id="hex" name="hex" value="#000000">
        </div>
        <div>
            <label>rgb:&nbsp;&nbsp;</label>
            <input id="rgb" name="rgb" value="(0, 0, 0)">
        </div>
        <div>
            <label>rgba:&nbsp;</label>
            <input id="rgba" name="rgba" value="(0, 0, 0, 1.0)">
        </div>
        <div>
            <!--<label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>-->
            <label>opacity:&nbsp;</label>
            <input id="opacity" name="opacity" type="range" min="0" max="100" value="100">
            <label id="opacityValueLabel">&nbsp;100%</label>
        </div>
    </div>
    <script>
        // settings
        let minSide = Math.min(document.body.clientWidth, document.body.clientHeight);
        let vmin = minSide / 100;
        // set canvas
        let cnv = document.querySelector('canvas');
        cnv.width = Math.min(document.body.clientWidth, document.body.clientHeight) - (Math.min(document.body.clientWidth, document.body.clientHeight) / 100 * 4);
        cnv.height = 150;
        let ctx = cnv.getContext('2d');
        window.addEventListener('resize', function () {
            cnv.width = Math.min(document.body.clientWidth, document.body.clientHeight) - (Math.min(document.body.clientWidth, document.body.clientHeight) / 100 * 4);
            redrawCanvas();
        }, false);
        // variables
        let inputHEX = document.querySelector('input#hex');
        let inputRGB = document.querySelector('input#rgb');
        let inputRGBA = document.querySelector('input#rgba');
        let inputOpacity = document.querySelector('input#opacity');
        // focus input hex
        inputHEX.focus();
        inputHEX.setSelectionRange(1, 1);
        // draw bg
        redrawCanvas();
        // input hex
        inputHEX.addEventListener('input', function (e) {
            // variables
            let caret = e.target.selectionStart;
            if (caret == 0) caret++;
            if (inputHEX.value.length == 1) caret++;
            // to lower case
            inputHEX.value = inputHEX.value.toLowerCase();
            // delete #
            inputHEX.value = inputHEX.value.replace('#', '');
            // check symbols
            for (let c = 1; c < inputHEX.value.length; c++) {
                switch (inputHEX.value[c]) {
                    case '0':
                    case '1':
                    case '2':
                    case '3':
                    case '4':
                    case '5':
                    case '6':
                    case '7':
                    case '8':
                    case '9':
                    case 'a':
                    case 'b':
                    case 'c':
                    case 'd':
                    case 'e':
                    case 'f':
                        break;
                    default:
                        inputHEX.value = inputHEX.value.replace(inputHEX.value[c], '');
                        inputHEX.setSelectionRange(caret - 1, caret - 1);
                        break;
                }
            }
            // crop length
            if (inputHEX.value.length > 5) {
                inputHEX.value = inputHEX.value.substring(0, 6);
                inputHEX.setSelectionRange(caret, caret);
            }
            // set length
            while (inputHEX.value.length < 6) {
                inputHEX.value = inputHEX.value + '0';
                inputHEX.setSelectionRange(caret, caret);
                //console.log(caret);
            }
            // prepend #
            inputHEX.value = '#' + inputHEX.value;
            inputHEX.setSelectionRange(caret, caret);
            // redraw
            redrawCanvas();
            // set colors
            let r = parseInt(inputHEX.value.substring(1, 3), 16);
            let g = parseInt(inputHEX.value.substring(3, 5), 16);
            let b = parseInt(inputHEX.value.substring(5, 7), 16);
            let opacity = (inputOpacity.value / 100).toString().length == 1 ? (inputOpacity.value / 100) + '.0' : (inputOpacity.value / 100);
            inputRGB.value = '(' + r + ', ' + g + ', ' + b + ')';
            inputRGBA.value = '(' + r + ', ' + g + ', ' + b + ', ' + opacity + ')';
        }, false);
        // input opacity
        inputOpacity.addEventListener('input', function (e) {
            // set label
            document.querySelector('#opacityValueLabel').innerHTML = '&nbsp;' + inputOpacity.value + '%';
            // set rgba
            let r = parseInt(inputHEX.value.substring(1, 3), 16);
            let g = parseInt(inputHEX.value.substring(3, 5), 16);
            let b = parseInt(inputHEX.value.substring(5, 7), 16);
            let opacity = (inputOpacity.value / 100).toString().length == 1 ? (inputOpacity.value / 100) + '.0' : (inputOpacity.value / 100);
            inputRGBA.value = '(' + r + ', ' + g + ', ' + b + ', ' + opacity + ')';
            // redraw
            redrawCanvas();
            // debug
            //console.log(inputOpacity.value);
        }, false);
        // redraw canvas
        function redrawCanvas() {
            ctx.clearRect(0, 0, cnv.width, cnv.height);
            ctx.globalAlpha = inputOpacity.value / 100;
            ctx.fillStyle = inputHEX.value;
            ctx.fillRect(0, 0, cnv.width, cnv.height);
        }
    </script>
</body>
</html>
